<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Generador de Confirmaciones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 2px solid #ccc;
      border-radius: 5px;
    }
    .invalid {
      border-color: red !important;
      background-color: #ffe5e5;
    }
    #imageContainer {
      border: 2px dashed #888;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      background: #fff;
      overflow: hidden;
    }
    #imageContainer img {
      max-height: 300px;
      max-width: 100%;
      object-fit: contain;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #output {
      margin-top: 30px;
      padding: 15px;
      background: #fff;
      border: 2px solid #0078D7;
    }
    .row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .col-6 {
      flex: 1 1 48%;
    }
    .guia {
      background: #e8f0ff;
      border: 1px solid #aac5e2;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .guia h3 {
      margin-top: 0;
    }
    .guia ol {
      padding-left: 20px;
    }
    .hidden {
      display: none;
    }

    /* üö® Estilos para popups */
    .popup {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 20px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      z-index: 9999;
      color: #fff;
      animation: blink 1s infinite;
    }
    #popup5 { background: #FFD700; color: #000; } /* Amarillo */
    #popup7 { background: #FF8C00; } /* Naranja */
    #popup10 { background: #B22222; } /* Rojo Escarlata */

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    .popup button {
      margin-top: 10px;
      background: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="guia">
    <h3>üìã Estructura sugerida para atenci√≥n telef√≥nica en Rangel Rehabilitaci√≥n</h3>
    <ol>
      <li><strong>Saludo inicial:</strong> ‚ÄúBienvenido a Rangel Rehabilitaci√≥n, le habla [nombre del asesor]. ¬øCon qui√©n tengo el gusto?‚Äù</li>
      <li><strong>Verificaci√≥n de identidad:</strong> Confirmar tipo / n√∫mero de documento, y tel√©fono.</li>
      <li><strong>Identificar motivo de la llamada:</strong> ‚Äú¬øEn qu√© podemos ayudarle hoy?‚Äù</li>
      <li><strong>Validar agenda m√©dica:</strong> Revisar SAP o CNT, agendar si hay disponibilidad. Si no, ofrecer contacto posterior.</li>
      <li><strong>Confirmar la gesti√≥n:</strong> Repetir los datos agendados y confirmar env√≠o de correo.</li>
      <li><strong>Cierre de llamada:</strong> ‚ÄúGracias por contactarnos. Que tenga un excelente d√≠a.‚Äù</li>
    </ol>
  </div>

  <h2>üì≤ Generador de Confirmaciones de Cita Rangel Rehabilitaci√≥n "Dedicados a la Excelencia"</h2>

  <div class="row">
    <div class="col-6">
      <label for="servicio">Servicio solicitado en IVR</label>
      <input type="text" id="servicio" readonly>
    </div>
    <div class="col-6">
      <label for="tipoDocumento">Tipo de Documento</label>
      <input type="text" id="tipoDocumento" readonly>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <label for="numeroDocumento">N√∫mero de Documento</label>
      <input type="text" id="numeroDocumento" readonly>
    </div>
    <div class="col-6">
      <label for="telefono">Tel√©fono</label>
      <input type="text" id="telefono" readonly>
    </div>
  </div>

  <hr>

  <div class="row">
    <div class="col-6">
      <label for="sede">Sede:</label>
      <select id="sede" onchange="verificarEspecialidad()">
        <option value="">--Seleccione una sede--</option>
        <option value="Sede Am√©ricas">Sede Am√©ricas</option>
        <option value="Piso 2 - Altos del Bosque">Piso 2 - Altos del Bosque</option>
        <option value="Piso 5 - Forest Medical Center">Piso 5 - Forest Medical Center</option>
        <option value="Piso 6 - Forest Medical Center">Piso 6 - Forest Medical Center</option>
        <option value="Calle 26 - Edificio Elemento">Calle 26 - Edificio Elemento</option>
        <option value="Sede Barranquilla">Sede Barranquilla</option>
      </select>
    </div>
    <div class="col-6 hidden" id="cantidadWrapper">
      <label for="cantidad">Cantidad de citas a confirmar:</label>
      <input id="cantidad" type="number" min="1" max="20" onchange="generarCamposFechas()"/>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <label for="especialidad">Especialidad:</label>
      <select id="especialidad" onchange="verificarEspecialidad()">
        <option value="">--Seleccione una especialidad--</option>
        <option value="Cl√≠nica de Dolor">Cl√≠nica de Dolor</option>
        <option value="Electrodiagn√≥stico">Electrodiagn√≥stico</option>
        <option value="Medicina F√≠sica y Rehabilitaci√≥n">Medicina F√≠sica y Rehabilitaci√≥n</option>
        <option value="Medicina Ocupacional o Laboral">Medicina Ocupacional o Laboral</option>
        <option value="Terapia">Terapia</option>
      </select>
    </div>
  </div>

  <div class="row hidden" id="contenedorFechas"></div>

  <label>üìé Recordatorio de la cita SAP o CNT (Ctrl + V):</label>
  <div id="imageContainer">Pegue aqu√≠ el recorte del recordatorio de la cita</div>

  <button onclick="generarConfirmacion()">üì© Generar Confirmaci√≥n Completa</button>
  <button onclick="limpiarCampos()">üßπ Limpiar</button>

  <div contenteditable="true" id="output"></div>
  <button onclick="copiarConfirmacion()">üìã Copiar Confirmaci√≥n</button>

  <!-- üö® Popups -->
  <div id="popup5" class="popup">
    ‚ö†Ô∏è Estimado asesor, lleva 5 minutos en la gesti√≥n<br>
        <br><button onclick="cerrarPopup('popup5')">Entendido</button>
  </div>

  <div id="popup7" class="popup">
    ‚ö†Ô∏è ¬°Atenci√≥n! lleva 7 minutos en la gesti√≥n:<br>
    Si necesita apoyo por favor contacte a su coordinador o monitores
    <br><button onclick="cerrarPopup('popup7')">Entendido</button>
  </div>

  <div id="popup10" class="popup">
    üö® L√≠mite de tiempo establecido. Para no afectar indicadores (10 minutos):<br>
    Por favor finalice pronto o escale la gesti√≥n
    <br><button onclick="cerrarPopup('popup10')">Entendido</button>
  </div>

<script>
let imagenPegada = null;

const sedesInfo = {
  "Sede Am√©ricas": {
    direccion: "CL 20 (Avenida de las Am√©ricas) # 43A - 32 - Bogot√° D.C.",
    mapa: "https://maps.app.goo.gl/F71EgmnxAHW5rnng6"
  },
  "Piso 2 - Altos del Bosque": {
    direccion: "Calle 134 No. 7 - 83 Torre 1 Piso 2 - Bogot√° D.C.",
    mapa: "https://maps.app.goo.gl/zvBLNfprPDRUkX4d7"
  },
  "Piso 5 - Forest Medical Center": {
    direccion: "Cra 7B Bis # 132-38 Piso 5 Ed. Forest Medical Center - Bogot√° D.C.",
    mapa: "https://maps.app.goo.gl/pJaUU8DZiRhETN3A6"
  },
  "Piso 6 - Forest Medical Center": {
    direccion: "Cra 7B Bis # 132-38 Piso 6 Ed. Forest Medical Center - Bogot√° D.C.",
    mapa: "https://maps.app.goo.gl/pJaUU8DZiRhETN3A6"
  },
  "Calle 26 - Edificio Elemento": {
    direccion: "Avenida Calle 26 (Avenida El Dorado) # 69 - 76 - Bogot√° D.C.",
    mapa: "https://maps.app.goo.gl/duCTfW3sobBPVREG9"
  },
  "Sede Barranquilla": {
    direccion: "Cr. 53 #68B - 13 barrio El Prado - Barranquilla",
    mapa: "https://maps.app.goo.gl/yDZ7d2hzodFZXCjU7"
  }
};

function verificarEspecialidad() {
  const especialidad = document.getElementById("especialidad").value;
  const sede = document.getElementById("sede").value;
  const cantidadWrapper = document.getElementById("cantidadWrapper");
  const contenedorFechas = document.getElementById("contenedorFechas");

  const mostrarCampos = (especialidad === "Terapia" && sede === "Sede Barranquilla");

  if (mostrarCampos) {
    cantidadWrapper.classList.remove("hidden");
    contenedorFechas.classList.remove("hidden");
  } else {
    cantidadWrapper.classList.add("hidden");
    contenedorFechas.classList.add("hidden");
    document.getElementById("cantidad").value = "";
    contenedorFechas.innerHTML = "";
  }
}

function generarCamposFechas() {
  const cantidad = parseInt(document.getElementById("cantidad").value) || 0;
  const contenedor = document.getElementById("contenedorFechas");
  contenedor.innerHTML = "";

  for (let i = 0; i < cantidad; i++) {
    const div = document.createElement("div");
    div.className = "col-6";

    const label = document.createElement("label");
    label.innerText = `Fecha y hora Cita ${i + 1}:`;
    const input = document.createElement("input");
    input.type = "datetime-local";
    input.classList.add("fecha-cita");

    div.appendChild(label);
    div.appendChild(input);
    contenedor.appendChild(div);
  }
}

document.addEventListener("paste", function (e) {
  const items = e.clipboardData.items;
  for (let item of items) {
    if (item.type.indexOf("image") !== -1) {
      const blob = item.getAsFile();
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.src = event.target.result;
        document.getElementById("imageContainer").innerHTML = "";
        document.getElementById("imageContainer").appendChild(img);
        imagenPegada = img.src;
      };
      reader.readAsDataURL(blob);
    }
  }
});

function generarConfirmacion() {
  const sede = document.getElementById("sede").value;
  const cantidad = parseInt(document.getElementById("cantidad").value) || 0;
  const especialidad = document.getElementById("especialidad").value;
  const fechas = document.querySelectorAll(".fecha-cita");

  if (!sede || !especialidad || !imagenPegada || 
      (especialidad === "Terapia" && sede === "Sede Barranquilla" && (cantidad === 0 || fechas.length !== cantidad))) {
    alert("‚ö†Ô∏è Por favor complete todos los campos y pegue la confirmaci√≥n de la Cita.");
    return;
  }

  const direccion = sedesInfo[sede]?.direccion || "Direcci√≥n no disponible";
  const mapa = sedesInfo[sede]?.mapa || "#";

  let listaFechas = "";
  if (especialidad === "Terapia" && sede === "Sede Barranquilla") {
    listaFechas = Array.from(fechas).map((el, i) => {
      const fecha = new Date(el.value);
      if (isNaN(fecha)) return `‚Ä¢ Cita ${i + 1}: Fecha no v√°lida`;
      const texto = fecha.toLocaleString("es-CO", {
        weekday: "long", year: "numeric", month: "long", day: "numeric",
        hour: "numeric", minute: "2-digit"
      });
      return `‚Ä¢ Cita ${i + 1}: ${texto}`;
    }).join("<br>");
  }

  const html = `
    <p> A continuaci√≥n, le compartimos la confirmaci√≥n de su cita para que pueda asistir:</p>
    <p>üìç <strong>Sede:</strong> ${sede}</p>
    <p>üè¢ <strong>Direcci√≥n:</strong> ${direccion}</p>
    <p>üåê <strong>¬øC√≥mo llegar?:</strong> <a href="${mapa}" target="_blank">${mapa}</a></p>
    ${(especialidad === "Terapia" && sede === "Sede Barranquilla") ? `<p>üìÖ <strong>Fechas y horas de las citas:</strong><br>${listaFechas}</p>` : ""}
    <p>ü©∫ <strong>Especialidad:</strong> ${especialidad}</p>
    <p>üñºÔ∏è <strong>Confirmaci√≥n de Cita:</strong></p>
    <img src="${imagenPegada}" style="max-width:100%; max-height:300px; object-fit:contain; border:1px solid #ccc;">
  `;

  document.getElementById("output").innerHTML = html;
}

function copiarConfirmacion() {
  const output = document.getElementById("output");
  const range = document.createRange();
  range.selectNode(output);
  const selection = window.getSelection();
  selection.removeAllRanges();
  selection.addRange(range);
  document.execCommand("copy");
  selection.removeAllRanges();
  alert("‚úÖ Confirmaci√≥n copiada por favor env√≠ela al usuario.");
}

function limpiarCampos() {
  document.getElementById("sede").value = "";
  document.getElementById("cantidad").value = "";
  document.getElementById("especialidad").value = "";
  document.getElementById("contenedorFechas").innerHTML = "";
  document.getElementById("imageContainer").innerHTML = "Pega aqu√≠ tu imagen";
  document.getElementById("output").innerHTML = "";
  imagenPegada = null;
  verificarEspecialidad();
}

// üö® Mostrar popups
setTimeout(() => { document.getElementById("popup5").style.display = "block"; }, 300000); // 5 min
setTimeout(() => { document.getElementById("popup7").style.display = "block"; }, 420000); // 7 min
setTimeout(() => { document.getElementById("popup10").style.display = "block"; }, 600); // 10 min

function cerrarPopup(id) {
  document.getElementById(id).style.display = "none";
}

// Llenar campos desde URL
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const servicio = params.get("service");
  const tipoDoc = params.get("tdoc");
  const documento = params.get("doc");
  const telefono = params.get("telefono");

  if (servicio) document.getElementById("servicio").value = decodeURIComponent(servicio);
  if (tipoDoc) document.getElementById("tipoDocumento").value = decodeURIComponent(tipoDoc);
  if (documento) document.getElementById("numeroDocumento").value = decodeURIComponent(documento);
  if (telefono) document.getElementById("telefono").value = decodeURIComponent(telefono);
});
</script>
</body>
</html>
